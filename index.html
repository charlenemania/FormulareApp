<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Formulare Übersicht</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Formulare Übersicht</h1>
  <input type="text" id="search" placeholder="Formular suchen..." onkeyup="searchFormular()">
  <div id="app"></div>
  <script>
    let data = null;
    fetch('formulare.json')
      .then(response => response.json())
      .then(json => {
        data = json;
        renderDemosysteme();
      });

    function renderDemosysteme() {
      const app = document.getElementById('app');
      app.innerHTML = '';
      data.demosysteme.forEach(ds => {
        const div = document.createElement('div');
        div.className = 'system';
        div.textContent = ds.name;
        div.onclick = () => renderFormulare(ds);
        app.appendChild(div);
      });
    }
    function renderFormulare(system) {
      const app = document.getElementById('app');
      app.innerHTML = `<h2>${system.name}</h2><button onclick="renderDemosysteme()">← Zurück</button>`;
      system.formulare.forEach(f => {
        const div = document.createElement('div');
        div.className = 'formular';
        div.textContent = f.name;
        div.onclick = () => renderItems(system, f);
        app.appendChild(div);
      });
    }
   function renderItems(system, formular) {
  const app = document.getElementById('app');
  app.innerHTML = `<h2>${formular.name}</h2><button onclick="renderFormulare({id:'${system.id}', name:'${system.name}', formulare:data.demosysteme.find(ds => ds.id==='${system.id}').formulare})">← Zurück</button>`;
  
  // Prüfen, ob questionnaireFile vorhanden ist
  if (formular.questionnaireFile) {
    // Externe JSON-Datei laden und als Code anzeigen
    fetch(formular.questionnaireFile)
      .then(response => response.json())
      .then(json => {
        const pre = document.createElement('pre');
        const code = document.createElement('code');
        code.textContent = JSON.stringify(json, null, 2);
        pre.appendChild(code);
        app.appendChild(pre);
      })
      .catch(error => {
        app.innerHTML += `<p style="color: red;">Fehler beim Laden: ${error.message}</p>`;
      });
  } else {
    // Bisheriges Verhalten: Items als Liste anzeigen
    const ul = document.createElement('ul');
    ul.className = 'items';
    formular.items.forEach(item => {
      const li = document.createElement('li');
      li.textContent = item;
      ul.appendChild(li);
    });
    app.appendChild(ul);
  }
}
    function searchFormular() {
      const term = document.getElementById('search').value.toLowerCase();
      const app = document.getElementById('app');
      app.innerHTML = '';
      if (!term) return renderDemosysteme();
      data.demosysteme.forEach(ds => {
        ds.formulare.forEach(f => {
          if (f.id.toLowerCase().includes(term) || f.name.toLowerCase().includes(term) || f.items.some(i => i.toLowerCase().includes(term))) {
            const div = document.createElement('div');
            div.textContent = `${f.name} (System: ${ds.name})`;
            app.appendChild(div);
          }
        });
      });
    }
  </script>
</body>
</html>








